{{template "layout" .}}
{{define "content"}}
<h1>{{statusIcon (print .Agent.Status.Phase)}} {{.Agent.Name}}</h1>

{{if .Triggered}}
<div class="flash flash-success">Ad-hoc run trigger queued.</div>
{{end}}

<div class="detail-grid">
  <div class="detail-card">
    <h3>Configuration</h3>
    <dl>
      <dt>Description</dt>
      <dd>{{.Agent.Spec.Description}}</dd>
      <dt>Autonomy</dt>
      <dd><code>{{.Agent.Spec.Guardrails.Autonomy}}</code></dd>
      <dt>Model Tier</dt>
      <dd>{{.Agent.Spec.Model.Tier}}</dd>
      <dt>Token Budget</dt>
      <dd>{{.Agent.Spec.Model.TokenBudget}}</dd>
      <dt>Max Iterations</dt>
      <dd>{{.Agent.Spec.Guardrails.MaxIterations}}</dd>
      <dt>Environment</dt>
      <dd>{{.Agent.Spec.EnvironmentRef}}</dd>
    </dl>
  </div>
  <div class="detail-card">
    <h3>Status</h3>
    <dl>
      <dt>Phase</dt>
      <dd>{{.Agent.Status.Phase}}</dd>
      <dt>Total Runs</dt>
      <dd>{{.Agent.Status.RunCount}}</dd>
      <dt>Consecutive Failures</dt>
      <dd>{{.Agent.Status.ConsecutiveFailures}}</dd>
      <dt>Last Run</dt>
      <dd>{{if .Agent.Status.LastRunTime}}{{timeAgo .Agent.Status.LastRunTime.Time}}{{else}}never{{end}}</dd>
      <dt>Next Run</dt>
      <dd>{{if .Agent.Status.NextRunTime}}{{formatTime .Agent.Status.NextRunTime.Time}}{{else}}—{{end}}</dd>
    </dl>
  </div>
  <div class="detail-card">
    <h3>Trigger Ad-hoc Run</h3>
    <form method="POST" action="/agents/{{.Agent.Name}}/run" class="run-trigger-form">
      <label for="target">Target (optional)</label>
      <input id="target" name="target" type="text" placeholder="e.g. db-prod-01" />

      <label for="task">Task (optional)</label>
      <textarea id="task" name="task" rows="3" placeholder="Optional task prompt"></textarea>

      <button type="submit" class="btn btn-approve">Run now</button>
    </form>
  </div>
</div>

<h2>Recent Runs</h2>
<table class="data-table">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>Trigger</th>
      <th>Iterations</th>
      <th>Tokens (in/out)</th>
      <th>Actions</th>
      <th>Duration</th>
      <th>Age</th>
    </tr>
  </thead>
  <tbody>
    {{range .Runs}}
    <tr>
      <td>{{statusIcon (print .Status.Phase)}}</td>
      <td><a href="/runs/{{.Name}}">{{.Name}}</a></td>
      <td>{{.Spec.Trigger}}</td>
      <td>{{with .Status.Usage}}{{.Iterations}}{{else}}0{{end}}</td>
      <td>{{with .Status.Usage}}{{tokensStr .TokensIn .TokensOut}}{{else}}—{{end}}</td>
      <td>{{len .Status.Actions}}</td>
      <td>{{with .Status.Usage}}{{durationMs .WallClockMs}}{{else}}—{{end}}</td>
      <td>{{timeAgo .CreationTimestamp.Time}}</td>
    </tr>
    {{else}}
    <tr><td colspan="8" class="empty">No runs yet</td></tr>
    {{end}}
  </tbody>
</table>
{{end}}
