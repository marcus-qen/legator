{{template "layout" .}}
{{define "content"}}
<h1>Approvals</h1>

<p class="subtle">Pending: {{.PendingApprovals}} / {{len .Approvals}}</p>

{{if not .Approvals}}
<p class="empty">No approval requests</p>
{{else}}
<table class="data-table">
  <thead>
    <tr>
      <th></th>
      <th>Agent</th>
      <th>Run</th>
      <th>Tool</th>
      <th>Tier</th>
      <th>Details</th>
      <th>Age</th>
      <th>Decision</th>
    </tr>
  </thead>
  <tbody>
    {{range .Approvals}}
    <tr>
      <td>{{statusIcon (print .Status.Phase)}}</td>
      <td><a href="/agents/{{.Spec.AgentName}}">{{.Spec.AgentName}}</a></td>
      <td>{{if .Spec.RunName}}{{.Spec.RunName}}{{else}}â€”{{end}}</td>
      <td><code>{{.Spec.Action.Tool}}</code></td>
      <td>{{.Spec.Action.Tier}}</td>
      <td>
        <div>{{truncate .Spec.Action.Description 90}}</div>
        {{if .Spec.Action.Target}}<div class="muted">Target: {{.Spec.Action.Target}}</div>{{end}}
      </td>
      <td>{{timeAgo .CreationTimestamp.Time}}</td>
      <td>
        {{if eq (print .Status.Phase) "Pending"}}
        <div class="approval-actions">
          <form method="POST" action="/approvals/{{.Name}}/approve" class="approval-action-form" style="display:inline">
            <input type="text" name="reason" class="approval-reason" placeholder="reason (optional)" />
            <button type="submit" class="btn btn-approve">Approve</button>
          </form>
          <form method="POST" action="/approvals/{{.Name}}/deny" class="approval-action-form" style="display:inline">
            <input type="text" name="reason" class="approval-reason" placeholder="reason (optional)" />
            <button type="submit" class="btn btn-deny">Deny</button>
          </form>
        </div>
        {{else}}
          <div class="approval-status">{{.Status.Phase}}</div>
          {{if .Status.Reason}}<div class="muted">Reason: {{.Status.Reason}}</div>{{end}}
          {{if .Status.DecidedBy}}
            <div class="muted">by {{.Status.DecidedBy}}{{if .Status.DecidedAt}} at {{formatTime .Status.DecidedAt.Time}}{{end}}</div>
          {{end}}
        {{end}}
      </td>
    </tr>
    {{end}}
  </tbody>
</table>
{{end}}
{{end}}
