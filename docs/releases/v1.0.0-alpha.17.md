# v1.0.0-alpha.17 — Jobs Reliability + Kubeflow Adapter MVP

Release date: 2026-02-28

## Highlights

### 1) Scheduled Jobs: operational maturity pass
- Added global run-history endpoint: `GET /api/v1/jobs/runs`
- Added run-history filters:
  - `status=pending|running|success|failed|canceled`
  - `probe_id=<id>`
  - `job_id=<id>`
  - `started_after=<RFC3339>`
  - `started_before=<RFC3339>`
  - `limit=<n>`
- Added run summary counters in API responses:
  - `failed_count`, `success_count`, `running_count`, `pending_count`, `canceled_count`
- Added cancellation endpoints:
  - `POST /api/v1/jobs/{id}/cancel`
    - `200 OK` with `{ job_id, status, canceled_runs, already_terminal_runs }`
  - `POST /api/v1/jobs/{id}/runs/{runId}/cancel`
    - `200 OK` with `{ job_id, run }` when transition to `canceled` succeeds
    - `409 invalid_transition` when the run is already terminal
- Hardened scheduler state transitions for fanout/concurrency:
  - overlap guards for in-flight `(job,probe)` dispatches
  - safer completion/status handling under concurrent result arrival

### 2) Kubeflow Adapter MVP (read-first)
- New package: `internal/controlplane/kubeflow`
- New endpoints:
  - `GET /api/v1/kubeflow/status`
  - `GET /api/v1/kubeflow/inventory`
  - `POST /api/v1/kubeflow/actions/refresh` (guarded)
- Action guardrails:
  - RBAC `fleet:write` required
  - disabled by default unless `LEGATOR_KUBEFLOW_ACTIONS_ENABLED=true`

### 3) SQLite write-contention hardening
- Added `PRAGMA busy_timeout=5000` across all SQLite-backed stores (15 total)
- Reduces `SQLITE_BUSY` failure mode during concurrent writes

## Validation
- Unit/integration: `go test ./...` ✅
- End-to-end: `./hack/e2e-test.sh` ✅ **67/67 passed**
- Production smoke:
  - control plane deployed and healthy
  - fleet online count: **6/6**

## Commits in release range
- `2b4d5ad` merge: alpha18 kubeflow adapter mvp
- `11b09fd` merge: alpha17 async execution phase 2 (jobs UX + reliability)
- `91a0bad` feat(jobs): improve run history queries and safer fanout status
- `6e782c5` feat(kubeflow): add read-only adapter MVP with guarded refresh action
- `de3e82c` fix: add PRAGMA busy_timeout=5000 to all 15 SQLite stores
- `e661b87` merge: scheduled probe jobs (cron engine)
- `67d8246` feat: scheduled probe jobs (cron engine)

## Upgrade notes
- No database migration required.
- New env vars (Kubeflow):
  - `LEGATOR_KUBEFLOW_ENABLED`
  - `LEGATOR_KUBEFLOW_NAMESPACE`
  - `LEGATOR_KUBEFLOW_KUBECONFIG`
  - `LEGATOR_KUBEFLOW_CONTEXT`
  - `LEGATOR_KUBEFLOW_CLI_PATH`
  - `LEGATOR_KUBEFLOW_TIMEOUT`
  - `LEGATOR_KUBEFLOW_ACTIONS_ENABLED`
