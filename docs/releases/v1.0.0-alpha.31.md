# v1.0.0-alpha.31 â€” Stage 3.8.2 automation packs dry-run + policy simulation

## Highlights

### 1) Non-mutating dry-run planning API

Added an additive dry-run route for automation packs:

- `POST /api/v1/automation-packs/dry-run`

The endpoint accepts inline definition + runtime inputs, validates contracts, resolves step plans, and returns simulation payloads without executing mutations.

### 2) Runtime input validation against definition contracts

Dry-run now validates runtime inputs using declared schema semantics:

- required/default handling
- strict type checks
- enum enforcement
- type-specific constraint checks
- unknown-input rejection

Validation failures return `400 invalid_inputs`.

### 3) Step/workflow policy what-if simulation

Integrated existing command policy logic in simulation mode for each resolved step, producing additive predictions:

- `allow`
- `queue`
- `deny`

Returned payload includes rationale metadata per step and workflow roll-up outcome.

### 4) Non-mutation guarantee

Dry-run responses now include explicit execution-mode signaling:

- `non_mutating: true`

Tests assert that dry-run does not persist definitions or mutate automation-pack storage state.

### 5) Coverage + docs

- Added handler-level tests for:
  - dry-run schema validation errors
  - dry-run input validation errors
  - step/workflow simulation results
  - non-mutation guarantees
- Added server permission coverage for dry-run route (`fleet:write` required).
- Updated automation-pack docs and README API references.

## Compatibility

- [compat:additive] Added `POST /api/v1/automation-packs/dry-run` and additive dry-run payload fields without removing or renaming existing REST/MCP identifiers.
