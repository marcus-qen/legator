{{define "base"}}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{block "title" .}}Legator{{end}}</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body data-page="{{.ActiveNav}}">
  <div class="layout">
    <aside class="nav" id="nav">
      <div class="nav-brand">LEGATOR</div>
      <nav class="nav-links">
        {{if hasPermission .CurrentUser "fleet:read"}}
        <a href="/" class="nav-link{{if eq .ActiveNav "fleet"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><rect x="2" y="2" width="20" height="8" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><rect x="2" y="14" width="20" height="8" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="6" cy="6" r="1" fill="currentColor"/><circle cx="6" cy="18" r="1" fill="currentColor"/></svg>
          Fleet <span class="badge" data-badge="probes"></span>
        </a>
        <a href="/federation" class="nav-link{{if eq .ActiveNav "federation"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><path d="M12 3l4 7h-8l4-7zM4 13h7v7H4zM13 13h7v7h-7z" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          Federation
        </a>
        <a href="/fleet/chat" class="nav-link{{if eq .ActiveNav "fleet-chat"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          Fleet Chat
        </a>
        <a href="/model-dock" class="nav-link{{if eq .ActiveNav "model-dock"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><path d="M4 6h16M4 12h16M4 18h16" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="7" cy="6" r="1.5" fill="currentColor"/><circle cx="13" cy="12" r="1.5" fill="currentColor"/><circle cx="17" cy="18" r="1.5" fill="currentColor"/></svg>
          Model Dock
        </a>
        <a href="/cloud-connectors" class="nav-link{{if eq .ActiveNav "cloud-connectors"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><path d="M7 17a4 4 0 110-8 5 5 0 019.6-1.5A3.5 3.5 0 1117.5 17H7z" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          Cloud Connectors
        </a>
        <a href="/network-devices" class="nav-link{{if eq .ActiveNav "network-devices"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><path d="M4 7h16M4 12h16M4 17h16" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="7" cy="7" r="1" fill="currentColor"/><circle cx="12" cy="12" r="1" fill="currentColor"/><circle cx="17" cy="17" r="1" fill="currentColor"/></svg>
          Network Devices
        </a>
        <a href="/discovery" class="nav-link{{if eq .ActiveNav "discovery"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><circle cx="11" cy="11" r="6" fill="none" stroke="currentColor" stroke-width="2"/><path d="M20 20l-4-4" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          Discovery
        </a>
        <a href="/jobs" class="nav-link{{if eq .ActiveNav "jobs"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="4" rx="1" fill="none" stroke="currentColor" stroke-width="2"/><rect x="3" y="10" width="18" height="4" rx="1" fill="none" stroke="currentColor" stroke-width="2"/><rect x="3" y="16" width="18" height="4" rx="1" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          Jobs
        </a>
        <a href="/alerts" class="nav-link{{if eq .ActiveNav "alerts"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          Alerts
        </a>
        {{end}}
        {{if hasPermission .CurrentUser "approval:read"}}
        <a href="/approvals" class="nav-link{{if eq .ActiveNav "approvals"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          Approvals <span class="badge" data-badge="approvals"></span>
        </a>
        {{end}}
        {{if hasPermission .CurrentUser "audit:read"}}
        <a href="/audit" class="nav-link{{if eq .ActiveNav "audit"}} active{{end}}">
          <svg class="icon" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z" fill="none" stroke="currentColor" stroke-width="2"/><polyline points="14 2 14 8 20 8" fill="none" stroke="currentColor" stroke-width="2"/></svg>
          Audit
        </a>
        {{end}}
      </nav>
      {{if .CurrentUser}}
      <div class="nav-footer">
        <div class="user-info">
          <span class="username">{{.CurrentUser.Username}}</span>
          <span class="role-tag">{{.CurrentUser.Role}}</span>
        </div>
        <form method="POST" action="/logout">
          <button type="submit" class="nav-link logout-btn">Logout</button>
        </form>
      </div>
      {{end}}
    </aside>
    <div class="nav-overlay" data-nav-close></div>
    <main class="main">
      <header class="topbar">
        <button class="nav-toggle" data-nav-toggle aria-label="Menu">â˜°</button>
        {{block "header" .}}{{end}}
      </header>
      <div class="content">
        {{block "content" .}}{{end}}
      </div>
    </main>
  </div>
  <div class="toast" id="toast"></div>
  <script src="/static/app.js"></script>
  {{block "scripts" .}}{{end}}
</body>
</html>
{{end}}
