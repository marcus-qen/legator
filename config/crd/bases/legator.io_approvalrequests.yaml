---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.20.1
  name: approvalrequests.legator.io
spec:
  group: legator.io
  names:
    kind: ApprovalRequest
    listKind: ApprovalRequestList
    plural: approvalrequests
    singular: approvalrequest
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.agentName
      name: Agent
      type: string
    - jsonPath: .spec.action.tool
      name: Action
      type: string
    - jsonPath: .spec.action.tier
      name: Tier
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ApprovalRequest is a proposed agent action awaiting human approval.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ApprovalRequestSpec defines a proposed action awaiting human
              approval.
            properties:
              action:
                description: action describes the proposed action.
                properties:
                  args:
                    additionalProperties:
                      type: string
                    description: args are the tool arguments (sanitised â€” no credentials).
                    type: object
                  description:
                    description: description is a human-readable summary.
                    type: string
                  target:
                    description: target describes what the action targets.
                    type: string
                  tier:
                    description: tier is the action classification.
                    type: string
                  tool:
                    description: tool is the tool name (e.g. "kubectl.apply", "ssh.exec").
                    type: string
                required:
                - description
                - target
                - tier
                - tool
                type: object
              agentName:
                description: agentName is the agent requesting approval.
                type: string
              channels:
                description: channels lists where to send the approval request notification.
                items:
                  type: string
                type: array
              context:
                description: context provides additional information for the approver.
                type: string
              runName:
                description: runName is the LegatorRun this request belongs to.
                type: string
              timeout:
                default: 30m
                description: timeout is how long to wait for approval before auto-denying.
                type: string
            required:
            - action
            - agentName
            - runName
            type: object
          status:
            description: ApprovalRequestStatus records the approval decision.
            properties:
              decidedAt:
                description: decidedAt is when the decision was made.
                format: date-time
                type: string
              decidedBy:
                description: decidedBy is who approved or denied (OIDC subject or
                  "system" for timeout).
                type: string
              phase:
                default: Pending
                description: phase is the current state.
                type: string
              reason:
                description: reason is an optional explanation for the decision.
                type: string
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
    subresources:
      status: {}
