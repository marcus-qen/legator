{{define "layout"}}<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{.Title}} ‚Äî Legator</title>
  <script src="https://unpkg.com/htmx.org@2.0.4"></script>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-brand">
      <a href="/">‚ö° Legator</a>
    </div>
    <div class="nav-links">
      <a href="/cockpit">Cockpit</a>
      <a href="/agents">Agents</a>
      <a href="/runs">Runs</a>
      <a href="/approvals">Approvals
        <span id="approval-badge" hx-get="/api/approvals-count" hx-trigger="every 30s" hx-swap="innerHTML"></span>
      </a>
      <a href="/events">Events</a>
    </div>
    <div class="nav-actions">
      <button id="theme-toggle" class="btn btn-ghost" type="button" title="Toggle light/dark theme" aria-label="Toggle light/dark theme">
        üåó Theme
      </button>
    </div>
  </nav>
  <main class="container">
    {{template "content" .}}
  </main>
  <footer class="footer">
    <p>Legator ‚Äî one who delegates</p>
  </footer>
  <script>
    (function () {
      var STORAGE_KEY = 'legator.theme';
      var root = document.documentElement;
      var btn = document.getElementById('theme-toggle');

      function applyTheme(theme) {
        var safe = theme === 'dark' ? 'dark' : 'light';
        root.setAttribute('data-theme', safe);
        if (btn) {
          btn.textContent = safe === 'dark' ? '‚òÄÔ∏è Light' : 'üåô Dark';
          btn.setAttribute('aria-label', safe === 'dark' ? 'Switch to light theme' : 'Switch to dark theme');
          btn.title = safe === 'dark' ? 'Switch to light theme' : 'Switch to dark theme';
        }
      }

      var initial = localStorage.getItem(STORAGE_KEY) || 'light';
      applyTheme(initial);

      if (btn) {
        btn.addEventListener('click', function () {
          var next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
          localStorage.setItem(STORAGE_KEY, next);
          applyTheme(next);
        });
      }
    })();
  </script>
</body>
</html>{{end}}
