{{define "layout"}}<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{.Title}} ‚Äî Legator</title>
  <script src="https://unpkg.com/htmx.org@2.0.4"></script>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-brand">
      <a href="/">‚ö° Legator</a>
    </div>
    <div class="nav-links">
      <a href="/cockpit">Cockpit</a>
      <a href="/agents">Agents</a>
      <a href="/runs">Runs</a>
      <a href="/approvals">Approvals
        <span id="approval-badge" hx-get="/api/approvals-count" hx-trigger="every 30s" hx-swap="innerHTML"></span>
      </a>
      <a href="/events">Events</a>
    </div>
    <div class="nav-actions">
      <button id="density-toggle" class="btn btn-ghost" type="button" title="Toggle compact density" aria-label="Toggle compact density">
        ‚áµ Density
      </button>
      <button id="theme-toggle" class="btn btn-ghost" type="button" title="Toggle light/dark theme" aria-label="Toggle light/dark theme">
        üåó Theme
      </button>
    </div>
  </nav>
  <main class="container">
    {{template "content" .}}
  </main>
  <footer class="footer">
    <p>Legator ‚Äî one who delegates</p>
  </footer>
  <script>
    (function () {
      var THEME_STORAGE_KEY = 'legator.theme';
      var DENSITY_STORAGE_KEY = 'legator.density';
      var root = document.documentElement;
      var themeButton = document.getElementById('theme-toggle');
      var densityButton = document.getElementById('density-toggle');

      function applyTheme(theme) {
        var safe = theme === 'dark' ? 'dark' : 'light';
        root.setAttribute('data-theme', safe);
        if (themeButton) {
          themeButton.textContent = safe === 'dark' ? '‚òÄÔ∏è Light' : 'üåô Dark';
          themeButton.setAttribute('aria-label', safe === 'dark' ? 'Switch to light theme' : 'Switch to dark theme');
          themeButton.title = safe === 'dark' ? 'Switch to light theme' : 'Switch to dark theme';
        }
      }

      function applyDensity(density) {
        var safe = density === 'compact' ? 'compact' : 'comfortable';
        root.setAttribute('data-density', safe);
        if (densityButton) {
          densityButton.textContent = safe === 'compact' ? '‚Üï Comfortable' : '‚Üï Compact';
          densityButton.setAttribute('aria-label', safe === 'compact' ? 'Switch to comfortable density' : 'Switch to compact density');
          densityButton.title = safe === 'compact' ? 'Switch to comfortable density' : 'Switch to compact density';
        }
      }

      var initialTheme = localStorage.getItem(THEME_STORAGE_KEY) || 'light';
      applyTheme(initialTheme);

      var initialDensity = localStorage.getItem(DENSITY_STORAGE_KEY) || 'comfortable';
      applyDensity(initialDensity);

      if (themeButton) {
        themeButton.addEventListener('click', function () {
          var next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
          localStorage.setItem(THEME_STORAGE_KEY, next);
          applyTheme(next);
        });
      }

      if (densityButton) {
        densityButton.addEventListener('click', function () {
          var next = root.getAttribute('data-density') === 'compact' ? 'comfortable' : 'compact';
          localStorage.setItem(DENSITY_STORAGE_KEY, next);
          applyDensity(next);
        });
      }
    })();
  </script>
</body>
</html>{{end}}
